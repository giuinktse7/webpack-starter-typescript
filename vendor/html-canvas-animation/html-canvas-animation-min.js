!function(t,i){"object"==typeof exports&&"object"==typeof module?module.exports=i():"function"==typeof define&&define.amd?define([],i):"object"==typeof exports?exports["html-canvas-animation"]=i():t["html-canvas-animation"]=i()}(window,(function(){return function(t){var i={};function e(s){if(i[s])return i[s].exports;var n=i[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,e),n.l=!0,n.exports}return e.m=t,e.c=i,e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:s})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(e.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var n in t)e.d(s,n,function(i){return t[i]}.bind(null,n));return s},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=0)}([function(t,i,e){t.exports=e(1)},function(t,i,e){"use strict";var s;e.r(i),e.d(i,"Rectangle",(function(){return d})),e.d(i,"Scale",(function(){return p})),e.d(i,"Translate",(function(){return m})),e.d(i,"LineAnimation",(function(){return x})),e.d(i,"PaletteAnimation",(function(){return g})),e.d(i,"HighlightPaletteAnimation",(function(){return y})),e.d(i,"highlightPalette",(function(){return F})),e.d(i,"normalize",(function(){return h})),e.d(i,"denormalize",(function(){return o})),e.d(i,"interpolate",(function(){return r})),e.d(i,"easing",(function(){return u})),e.d(i,"CanvasLoop",(function(){return b})),function(t){t[t.Active=0]="Active",t[t.FadeOut=1]="FadeOut",t[t.Gone=2]="Gone",t[t.ScheduledForDeletion=3]="ScheduledForDeletion"}(s||(s={}));class n{constructor(t){this.identifier="N/A",this.temporary=!1,this.animationState={type:s.Active},this.finished=!1,this.renderOptions=()=>{const t={};switch(this.animationState.type){case s.FadeOut:t.opacity=this.animationState.opacity}return 0===Object.keys(t).length?void 0:t},this.isFinished=()=>this.finished,this.setFinished=t=>{this.finished&&!t&&console.warn("this.finished was true, but setting it back to false?"),this.finished=t},this.setName=t=>{this.identifier=t},this.update=t=>{var i;switch(this.animationState.type){case s.Active:break;case s.FadeOut:{this.animationState.elapsedTime+=t;const i=this.animationState.elapsedTime/this.animationState.duration;this.animationState.opacity=Math.max(1-this.animationState.easingFunction(i),0),0===this.animationState.opacity&&(this.animationState=this.animationState.removeWhenInvisible?{type:s.ScheduledForDeletion}:{type:s.Gone});break}case s.Gone:case s.ScheduledForDeletion:return!0}const e=this.isFinished(),n=this.updateAnimation(t);return!e&&n&&(null===(i=this.onFinish)||void 0===i||i.call(this)),n},this.setRenderOptions=t=>{const{ctx:i}=this;return i.save(),t.opacity&&(i.globalAlpha=t.opacity),()=>i.restore()},this.render=t=>{if(this.shouldDraw())if(void 0!==t){const i=this.setRenderOptions(t);this.draw(),i()}else this.draw()},this.fadeOut=(t,i=(t=>t),e=!0)=>{this.animationState.type!==s.Gone&&(this.animationState={type:s.FadeOut,removeWhenInvisible:e,elapsedTime:0,duration:t,opacity:1,easingFunction:i})},this.shouldDelete=()=>this.animationState.type===s.ScheduledForDeletion||this.isFinished()&&this.temporary,this.getContext=()=>this.ctx,this.updateContext=()=>{const t=this.ctx.globalAlpha;switch(this.animationState.type){case s.FadeOut:this.ctx.globalAlpha*=this.animationState.opacity}return()=>{this.ctx.globalAlpha=t}},this.shouldDraw=()=>{const t=this.animationState;switch(t.type){case s.Gone:case s.ScheduledForDeletion:return!1;case s.FadeOut:if(0===t.opacity)return!1}return!0},this.stroke=()=>{if(this.animationState.type===s.Gone)return;const t=this.updateContext();this.ctx.stroke(),t()},this.fillRect=(t,i,e,n)=>{if(this.animationState.type===s.Gone)return;const a=this.updateContext();this.ctx.fillRect(t,i,e,n),a()},this.strokeRect=(t,i,e,n)=>{if(this.animationState.type===s.Gone)return;const a=this.updateContext();this.ctx.strokeRect(t,i,e,n),a()},this.ctx=t}}class a extends n{constructor(t){super(t),this.empty=()=>0===this.size(),this.updateAnimation=t=>{const{size:i,get:e,removeAtIndex:s,setFinished:n,isFinished:a}=this;if(0===i())return!0;let h=0;for(;h<i();){const i=e(h);if(i.shouldDelete()){s(h);continue}if(!i.update(t))return n(!1),a();++h}return n(!0),a()},this.draw=()=>{const{empty:t,size:i,get:e}=this;if(t())return;let s=!1,n=0;for(;!s;){const t=e(n);t.render(this.renderOptions()),++n,s=!t.isFinished()||n==i()}}}}function h(t,i,e){return(t-i)/(e-i)}function o(t,i,e){return i+(e-i)*t}const r=(t,i)=>e=>o(t(h(e,i.from,i.to)),i.from,i.to);var c,u={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>t*(2-t),easeInOutQuad:t=>t<.5?2*t*t:(4-2*t)*t-1,easeInCubic:t=>t*t*t,easeOutCubic:t=>--t*t*t+1,easeInOutCubic:t=>t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1,easeInQuart:t=>t*t*t*t,easeOutQuart:t=>1- --t*t*t*t,easeInOutQuart:t=>t<.5?8*t*t*t*t:1-8*--t*t*t*t,easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>1+--t*t*t*t*t,easeInOutQuint:t=>t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t};class l extends n{constructor({ctx:t,rectangle:i,duration:e,easingFunction:s}){super(t),this.elapsedTime=0,this.easingFunction=t=>t,this.draw=()=>{this.ctx.save(),this.ctx.fillStyle=this.rectangle.color,this.fillRect(this.rectangle.x,this.rectangle.y,this.rectangle.width,this.rectangle.height),this.ctx.restore()},this.rectangle=i,this.duration=e,s&&(this.easingFunction=s)}}class d{constructor(t,i=0,e=0,s=0,n=0){this.scale=(t,i,e)=>new f(t,s=>new p({ctx:t,rectangle:s,duration:i,toSize:e}),this),this.translate=(t,i,e)=>new f(t,s=>new m({ctx:t,rectangle:s,duration:i,to:e}),this),this.color=t,this.x=i,this.y=e,this.width=s,this.height=n}static animate(t){return new f(t)}static scale({ctx:t,duration:i,size:e,easingFunction:s,name:n}){return new f(t,a=>{const h=new p({ctx:t,rectangle:a,duration:i,toSize:e,easingFunction:s});return n&&h.setName(n),h})}static translate(t,i,e){return new f(t,s=>new m({ctx:t,rectangle:s,duration:i,to:e}))}}class p extends l{constructor({ctx:t,toSize:i,duration:e,rectangle:s,easingFunction:n}){super({ctx:t,rectangle:s,duration:e,easingFunction:n}),this.updateAnimation=t=>{if(this.isFinished())return!0;this.elapsedTime=Math.min(this.elapsedTime+t,this.duration);const i=this.easingFunction(this.elapsedTime/this.duration),e=o(i,this.fromSize.width,this.toSize.width),s=o(i,this.fromSize.height,this.toSize.height),n=e-this.rectangle.width;this.rectangle.x-=n/2;const a=s-this.rectangle.height;return this.rectangle.y-=a/2,this.rectangle.width=e,this.rectangle.height=s,this.elapsedTime>=this.duration&&this.setFinished(!0),this.isFinished()},this.duration=e,this.toSize=i,this.rectangle=s,this.fromSize={width:this.rectangle.width,height:this.rectangle.height}}}class m extends l{constructor({ctx:t,duration:i,to:e,rectangle:s,easingFunction:n}){super({ctx:t,rectangle:s,duration:i,easingFunction:n}),this.updateAnimation=t=>{if(this.isFinished())return!0;this.elapsedTime=Math.min(this.elapsedTime+t,this.duration);const i=this.easingFunction(this.elapsedTime/this.duration),e=o(i,this.from.x,this.to.x),s=o(i,this.from.y,this.to.y);return this.rectangle.x=e,this.rectangle.y=s,this.elapsedTime>=this.duration&&this.setFinished(!0),this.isFinished()},this.duration=i,this.from={x:this.rectangle.x,y:this.rectangle.y},this.to=e}}class f extends a{constructor(t,i,e){super(t),this.animations=[],this.animationThunks=[],this.size=()=>this.animations.length+this.animationThunks.length,this.removeAtIndex=t=>{this.animations.splice(t,1)},this.get=t=>{for(;t>=this.animations.length;)this.materializeThunk();return this.animations[t]},this.add=t=>{this.animations.push(t)},this.materializeThunk=()=>{this.add(this.animationThunks[0](this.rectangle)),this.animationThunks.splice(0,1)},this.setRectangle=t=>{const i={...t};this.rectangle=i},this.addThunk=t=>{this.animationThunks.push(t)},this.scale=({duration:t,size:i,easingFunction:e})=>(this.addThunk(s=>new p({ctx:this.ctx,rectangle:s,duration:t,toSize:i,easingFunction:e})),this),this.translate=({duration:t,to:i,easingFunction:e,name:s})=>(this.addThunk(n=>{const a=new m({ctx:this.ctx,rectangle:n,duration:t,to:i,easingFunction:e});return s&&a.setName(s),a}),this),e&&(this.rectangle=e),i&&this.addThunk(i)}}class x extends n{constructor(t,i,e,s){super(t),this.setTemporary=t=>{this.temporary=t},this.updateAnimation=t=>{if(!t||0===t)return!1;if(this.isFinished())return!0;const i=t/this.duration;return this.current.x+=(this.to.x-this.from.x)*i,this.current.y+=(this.to.y-this.from.y)*i,this.abs.x<=Math.abs(this.current.x-this.from.x)&&this.abs.y<=Math.abs(this.current.y-this.from.y)&&(this.current=this.to,this.setFinished(!0)),this.isFinished()},this.draw=()=>{this.ctx.beginPath(),this.ctx.moveTo(this.from.x,this.from.y),this.ctx.lineTo(this.current.x,this.current.y),this.stroke()},this.from={...i},this.to={...e},this.current={...i},this.duration=s,this.abs={x:Math.abs(e.x-i.x),y:Math.abs(e.y-i.y)}}}class g extends n{constructor({ctx:t,swatch:i,topLeft:e,boxSize:s,duration:n}){super(t),this.setTemporary=t=>this.temporary=t,this.updateAnimation=t=>{if(!t||0===t)return!1;if(this.isFinished())return!0;this.currentColorIndex=Math.floor(Math.abs(this.current.x-this.topLeft.x)/this.boxSize);const i=t/this.duration;return this.current.x+=this.swatch.palette.length*this.boxSize*i,this.currentColorIndex>=this.swatch.palette.length&&(this.currentColorIndex=this.swatch.palette.length-1,this.setFinished(!0)),this.isFinished()},this.draw=()=>{for(let t=0;t<this.currentColorIndex+1;t++)this.ctx.fillStyle=this.swatch.palette[t],this.fillRect(this.topLeft.x+this.boxSize*t,this.topLeft.y,this.boxSize,this.boxSize)},this.swatch=i,this.topLeft={...e},this.current={...e},this.boxSize=s,this.duration=n,this.temporary=!1,this.currentColorIndex=Math.floor(Math.abs(this.current.x-this.topLeft.x)/this.boxSize)}}!function(t){t[t.Cycling=0]="Cycling",t[t.Blinking=1]="Blinking",t[t.Focus=2]="Focus"}(c||(c={}));class y extends n{constructor({animation:t,duration:i,easingFunction:e}){super(t.ctx),this.LoopCount=2,this.xOffset=0,this.state={state:c.Cycling,elapsedTime:0},this.elapsedTime=0,this.currentIndex=0,this.boxOpacity=1,this.increasingOpacity=!1,this.temporary=!1,this.FadeOutInDurationMs=250,this.BlinkAmount=3,this.BlinkDurationMs=this.FadeOutInDurationMs*this.BlinkAmount,this.FocusDurationMs=1e3,this.updateAnimation=t=>{if(!t||0===t)return!1;if(this.animation.update(t),!this.animation.isFinished())return!1;if(this.isFinished())return!0;this.elapsedTime=Math.min(this.elapsedTime+t,this.totalDurationMs),this.state.elapsedTime+=t;const i=Math.min(this.elapsedTime/this.cycleDurationMs,1);this.currentIndex=Math.round(this.easingFunction(i)*this.finalIndex);const e=this.currentIndex%this.animation.swatch.palette.length;switch(this.xOffset=e*this.animation.boxSize,this.state.state){case c.Cycling:this.state.elapsedTime>=this.cycleDurationMs&&(this.state={state:c.Blinking,elapsedTime:0});break;case c.Blinking:this.updateOpacity(t),this.state.elapsedTime>=this.BlinkDurationMs&&(this.state={state:c.Focus,elapsedTime:0},this.animation.fadeOut(1e3,u.easeOutCubic));break;case c.Focus:this.state.elapsedTime>=this.FocusDurationMs&&this.setFinished(!0)}return this.isFinished()},this.draw=()=>{if(this.animation.render(),!this.animation.isFinished())return;if(this.state.state===c.Focus){const t=this.ctx.fillStyle;this.ctx.fillStyle=this.animation.swatch.prominentColor,this.fillRect(this.animation.topLeft.x+this.xOffset,this.animation.topLeft.y,this.animation.boxSize,this.animation.boxSize),this.ctx.fillStyle=t}const t=this.ctx.globalAlpha,i=this.ctx.lineWidth;this.state.state===c.Blinking&&(this.ctx.globalAlpha=this.boxOpacity),this.ctx.save(),this.ctx.lineWidth=5,this.strokeRect(this.animation.topLeft.x+this.xOffset,this.animation.topLeft.y,this.animation.boxSize,this.animation.boxSize),this.ctx.restore(),this.ctx.globalAlpha=t,this.ctx.lineWidth=i},this.highlightPosition=()=>{const t={...this.animation.topLeft};return t.x+=this.xOffset,t},this.updateOpacity=t=>{const i=t/6/50;this.increasingOpacity?(this.boxOpacity+=i,this.boxOpacity>1&&(this.boxOpacity=1,this.increasingOpacity=!1)):(this.boxOpacity-=i,this.boxOpacity<0&&(this.boxOpacity=0,this.increasingOpacity=!0))},this.cycleDurationMs=i-this.BlinkDurationMs-this.FadeOutInDurationMs,this.totalDurationMs=this.cycleDurationMs+this.BlinkDurationMs+this.FocusDurationMs,this.animation=t;const s=t.swatch.palette.findIndex(i=>i===t.swatch.prominentColor);this.finalIndex=this.LoopCount*t.swatch.palette.length+s,this.easingFunction=null!=e?e:t=>t}}const F=t=>new y(t);class b{constructor(t){this.entities=[],this.finished=!1,this.clear=()=>{this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},this.addEntity=t=>{this.entities.push(t),this.finished&&(this.finished=!1,this.start())},this.start=()=>{this.requestFrame()},this.requestFrame=()=>{window.requestAnimationFrame(this.update)},this.finish=()=>{var t;this.finished||(this.finished=!0,null===(t=this.onFinish)||void 0===t||t.call(this))},this.update=()=>{if(0===this.entities.length&&this.finish(),this.finished)return;this.clear(),void 0===this.lastUpdateTime&&(this.lastUpdateTime=Date.now(),this.requestFrame());const t=Date.now(),i=t-this.lastUpdateTime;this.lastUpdateTime=t;for(let t=0;t<this.entities.length;++t)this.entities[t].shouldDelete()?this.entities.splice(t,1):this.entities[t].update(i);this.entities.forEach(t=>t.draw()),this.requestFrame()},this.canvas=t,this.ctx=t.getContext("2d")}}b.create=t=>null===t.getContext("2d")?null:new b(t)}])}));
//# sourceMappingURL=html-canvas-animation-min.js.map