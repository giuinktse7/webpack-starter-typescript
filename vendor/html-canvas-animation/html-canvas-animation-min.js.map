{"version":3,"sources":["webpack://html-canvas-animation/webpack/universalModuleDefinition","webpack://html-canvas-animation/webpack/bootstrap","webpack://html-canvas-animation/./src/animation.ts","webpack://html-canvas-animation/./src/easing.ts","webpack://html-canvas-animation/./src/paletteAnimation.ts","webpack://html-canvas-animation/./src/rectangleAnimation.ts","webpack://html-canvas-animation/./src/lineAnimation.ts","webpack://html-canvas-animation/./src/canvasLoop.ts"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","AnimationType","BaseAnimation","ctx","identifier","temporary","animationState","type","Active","finished","renderOptions","options","this","FadeOut","opacity","keys","length","undefined","isFinished","setFinished","console","warn","setName","update","deltaTime","elapsedTime","duration","Math","max","easingFunction","removeWhenInvisible","ScheduledForDeletion","Gone","wasFinished","updateAnimation","onFinish","setRenderOptions","save","globalAlpha","restore","render","shouldDraw","draw","fadeOut","f","x","shouldDelete","getContext","updateContext","oldOpacity","state","stroke","resetContext","fillRect","y","w","h","strokeRect","BaseSequential","super","empty","size","delta","removeAtIndex","animation","done","normalize","min","denormalize","interpolate","range","from","to","HighlightPatternState","linear","easeInQuad","easeOutQuad","easeInOutQuad","easeInCubic","easeOutCubic","easeInOutCubic","easeInQuart","easeOutQuart","easeInOutQuart","easeInQuint","easeOutQuint","easeInOutQuint","rectangle","fillStyle","color","width","height","Rectangle","scale","toSize","translate","fromSize","deltaWidth","deltaHeight","thunk","animations","animationThunks","index","splice","materializeThunk","add","push","setRectangle","rect","addThunk","setTemporary","part","current","abs","beginPath","moveTo","lineTo","swatch","topLeft","boxSize","currentColorIndex","floor","palette","LoopCount","xOffset","Cycling","currentIndex","boxOpacity","increasingOpacity","FadeOutInDurationMs","BlinkAmount","BlinkDurationMs","FocusDurationMs","totalDurationMs","cycleDurationMs","round","finalIndex","highlightIndex","Blinking","updateOpacity","Focus","oldFillStyle","prominentColor","oldWidth","lineWidth","highlightPosition","pos","deltaOpacity","prominentIndex","findIndex","highlightPalette","config","CanvasLoop","canvas","entities","clear","clearRect","addEntity","entity","start","requestFrame","requestAnimationFrame","finish","lastUpdateTime","Date","now","dt","forEach","e"],"mappings":"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","file":"html-canvas-animation-min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"html-canvas-animation\"] = factory();\n\telse\n\t\troot[\"html-canvas-animation\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","import { EasingFunction } from \"./easing\";\r\n\r\nexport type Point2D = { x: number; y: number };\r\n\r\ninterface RenderOptions {\r\n  opacity?: number;\r\n}\r\n\r\nexport enum AnimationType {\r\n  Active = 0,\r\n  FadeOut = 1,\r\n  Gone = 2,\r\n  ScheduledForDeletion = 3,\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-namespace\r\nnamespace Anim {\r\n  export type Active = {\r\n    type: AnimationType.Active;\r\n  };\r\n\r\n  export type FadeOut = {\r\n    type: AnimationType.FadeOut;\r\n    elapsedTime: number;\r\n    duration: number;\r\n    opacity: number;\r\n    removeWhenInvisible: boolean;\r\n    easingFunction: EasingFunction;\r\n  };\r\n\r\n  export type Gone = {\r\n    type: AnimationType.Gone;\r\n  };\r\n\r\n  export type ScheduledForDeletion = {\r\n    type: AnimationType.ScheduledForDeletion;\r\n  };\r\n}\r\n\r\ntype AnimationState =\r\n  | Anim.Active\r\n  | Anim.FadeOut\r\n  | Anim.Gone\r\n  | Anim.ScheduledForDeletion;\r\n\r\nexport interface Animation {\r\n  animationState: AnimationState;\r\n  update: (deltaTime: number) => boolean;\r\n  render: (renderOptions?: RenderOptions) => void;\r\n\r\n  isFinished: () => boolean;\r\n  temporary: boolean;\r\n\r\n  fadeOut: (duration: number, f?: EasingFunction) => void;\r\n  getContext(): CanvasRenderingContext2D;\r\n\r\n  shouldDelete(): boolean;\r\n\r\n  identifier: string;\r\n  setName: (name: string) => void;\r\n}\r\n\r\nexport abstract class BaseAnimation implements Animation {\r\n  identifier = \"N/A\";\r\n  readonly ctx: CanvasRenderingContext2D;\r\n  temporary = false;\r\n  animationState: AnimationState = { type: AnimationType.Active };\r\n  private finished = false;\r\n  onFinish?: () => void;\r\n\r\n  protected renderOptions = (): RenderOptions | undefined => {\r\n    const options: RenderOptions = {};\r\n    switch (this.animationState.type) {\r\n      case AnimationType.FadeOut: {\r\n        options.opacity = this.animationState.opacity;\r\n        break;\r\n      }\r\n      default:\r\n        break;\r\n    }\r\n\r\n    const empty = Object.keys(options).length === 0;\r\n    return empty ? undefined : options;\r\n  };\r\n\r\n  protected abstract updateAnimation: (deltaTime: number) => boolean;\r\n  protected abstract draw: () => void;\r\n  isFinished = (): boolean => this.finished;\r\n  setFinished = (finished: boolean): void => {\r\n    if (this.finished && !finished) {\r\n      console.warn(\"this.finished was true, but setting it back to false?\");\r\n    }\r\n\r\n    // if (!this.finished && finished) {\r\n    //   if (this.identifier === \"N/A\") {\r\n    //     console.log(this);\r\n    //   }\r\n    //   console.log(\"Animation \" + this.identifier + \" finished.\");\r\n    // }\r\n\r\n    this.finished = finished;\r\n  };\r\n\r\n  constructor(ctx: CanvasRenderingContext2D) {\r\n    this.ctx = ctx;\r\n  }\r\n\r\n  setName = (name: string) => {\r\n    this.identifier = name;\r\n  };\r\n\r\n  update = (deltaTime: number) => {\r\n    switch (this.animationState.type) {\r\n      case AnimationType.Active:\r\n        break;\r\n      case AnimationType.FadeOut: {\r\n        this.animationState.elapsedTime += deltaTime;\r\n        const t =\r\n          this.animationState.elapsedTime / this.animationState.duration;\r\n        this.animationState.opacity = Math.max(\r\n          1 - this.animationState.easingFunction(t),\r\n          0\r\n        );\r\n\r\n        if (this.animationState.opacity === 0) {\r\n          this.animationState = this.animationState.removeWhenInvisible\r\n            ? { type: AnimationType.ScheduledForDeletion }\r\n            : { type: AnimationType.Gone };\r\n        }\r\n\r\n        break;\r\n      }\r\n\r\n      case AnimationType.Gone:\r\n        return true;\r\n      case AnimationType.ScheduledForDeletion:\r\n        return true;\r\n    }\r\n    const wasFinished = this.isFinished();\r\n    const finished = this.updateAnimation(deltaTime);\r\n    if (!wasFinished && finished) {\r\n      this.onFinish?.();\r\n    }\r\n\r\n    return finished;\r\n  };\r\n\r\n  setRenderOptions = (options: RenderOptions): (() => void) => {\r\n    const { ctx } = this;\r\n    ctx.save();\r\n    if (options.opacity) {\r\n      ctx.globalAlpha = options.opacity;\r\n    }\r\n    return () => ctx.restore();\r\n  };\r\n\r\n  render = (options?: RenderOptions) => {\r\n    if (!this.shouldDraw()) return;\r\n    if (options !== undefined) {\r\n      const restore = this.setRenderOptions(options);\r\n      this.draw();\r\n      restore();\r\n    } else {\r\n      this.draw();\r\n    }\r\n  };\r\n\r\n  fadeOut = (\r\n    duration: number,\r\n    f: EasingFunction = (x: number) => x,\r\n    removeWhenInvisible = true\r\n  ) => {\r\n    if (this.animationState.type === AnimationType.Gone) return;\r\n\r\n    this.animationState = {\r\n      type: AnimationType.FadeOut,\r\n      removeWhenInvisible,\r\n      elapsedTime: 0,\r\n      duration,\r\n      opacity: 1,\r\n      easingFunction: f,\r\n    };\r\n  };\r\n\r\n  shouldDelete = (): boolean => {\r\n    const result =\r\n      this.animationState.type === AnimationType.ScheduledForDeletion ||\r\n      (this.isFinished() && this.temporary);\r\n\r\n    return result;\r\n  };\r\n\r\n  getContext = () => this.ctx;\r\n\r\n  updateContext = () => {\r\n    const oldOpacity = this.ctx.globalAlpha;\r\n\r\n    switch (this.animationState.type) {\r\n      case AnimationType.FadeOut:\r\n        this.ctx.globalAlpha *= this.animationState.opacity;\r\n    }\r\n\r\n    return () => {\r\n      this.ctx.globalAlpha = oldOpacity;\r\n    };\r\n  };\r\n\r\n  shouldDraw = (): boolean => {\r\n    const state = this.animationState;\r\n\r\n    switch (state.type) {\r\n      case AnimationType.Gone:\r\n      case AnimationType.ScheduledForDeletion:\r\n        return false;\r\n      case AnimationType.FadeOut:\r\n        if (state.opacity === 0) return false;\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n\r\n    return true;\r\n  };\r\n\r\n  stroke = () => {\r\n    if (this.animationState.type === AnimationType.Gone) return;\r\n\r\n    const resetContext = this.updateContext();\r\n    this.ctx.stroke();\r\n    resetContext();\r\n  };\r\n\r\n  fillRect = (x: number, y: number, w: number, h: number): void => {\r\n    if (this.animationState.type === AnimationType.Gone) return;\r\n\r\n    const resetContext = this.updateContext();\r\n    this.ctx.fillRect(x, y, w, h);\r\n    resetContext();\r\n  };\r\n\r\n  strokeRect = (x: number, y: number, w: number, h: number): void => {\r\n    if (this.animationState.type === AnimationType.Gone) return;\r\n\r\n    const resetContext = this.updateContext();\r\n    this.ctx.strokeRect(x, y, w, h);\r\n    resetContext();\r\n  };\r\n}\r\n\r\nexport class Parallel extends BaseAnimation {\r\n  animations: Animation[];\r\n  constructor(...animations: Animation[]) {\r\n    super(animations[0].getContext());\r\n\r\n    this.animations = animations;\r\n  }\r\n\r\n  updateAnimation = (delta: number) => {\r\n    if (this.animations.length === 0) return true;\r\n\r\n    let allFinished = true;\r\n\r\n    let i = 0;\r\n    while (i < this.animations.length) {\r\n      if (this.animations[i].shouldDelete()) {\r\n        this.animations.splice(i, 1);\r\n        continue;\r\n      }\r\n\r\n      const finished = this.animations[i].update(delta);\r\n      allFinished = allFinished && finished;\r\n      ++i;\r\n    }\r\n\r\n    this.setFinished(allFinished);\r\n    return this.isFinished();\r\n  };\r\n\r\n  draw = () => {\r\n    this.animations.forEach(a => a.render(this.renderOptions()));\r\n  };\r\n}\r\n\r\nexport abstract class BaseSequential<\r\n  A extends Animation = Animation\r\n> extends BaseAnimation {\r\n  abstract size(): number;\r\n  abstract removeAtIndex(index: number): void;\r\n  abstract get(index: number): A;\r\n  abstract add(animation: A): void;\r\n  empty = (): boolean => this.size() === 0;\r\n\r\n  constructor(ctx: CanvasRenderingContext2D) {\r\n    super(ctx);\r\n  }\r\n\r\n  updateAnimation = (delta: number) => {\r\n    const { size, get, removeAtIndex, setFinished, isFinished } = this;\r\n    if (size() === 0) return true;\r\n\r\n    let i = 0;\r\n    while (i < size()) {\r\n      const animation = get(i);\r\n      if (animation.shouldDelete()) {\r\n        removeAtIndex(i);\r\n        continue;\r\n      }\r\n      const finished = animation.update(delta);\r\n      if (finished) {\r\n        ++i;\r\n      } else {\r\n        setFinished(false);\r\n        return isFinished();\r\n      }\r\n    }\r\n\r\n    setFinished(true);\r\n    return isFinished();\r\n  };\r\n\r\n  draw = () => {\r\n    const { empty, size, get } = this;\r\n    if (empty()) return;\r\n\r\n    let done = false;\r\n    let i = 0;\r\n    while (!done) {\r\n      const animation = get(i);\r\n      animation.render(this.renderOptions());\r\n      ++i;\r\n      done = !animation.isFinished() || i == size();\r\n    }\r\n  };\r\n}\r\n\r\nexport class Sequential extends BaseSequential {\r\n  private animations: Animation[];\r\n\r\n  constructor(ctx: CanvasRenderingContext2D) {\r\n    super(ctx);\r\n\r\n    this.animations = [];\r\n  }\r\n\r\n  size = (): number => this.animations.length;\r\n\r\n  removeAtIndex = (index: number): void => {\r\n    this.animations.splice(index, 1);\r\n  };\r\n\r\n  get = (index: number): Animation => {\r\n    return this.animations[index];\r\n  };\r\n\r\n  add = (animation: Animation): void => {\r\n    this.animations.push(animation);\r\n  };\r\n\r\n  static create(...animations: Animation[]): Sequential {\r\n    const result = new Sequential(animations[0].getContext());\r\n    result.animations = animations;\r\n\r\n    return result;\r\n  }\r\n}\r\n","export type EasingFunction = (t: number) => number;\r\n\r\nconst easing = {\r\n  /** no easing, no acceleration */\r\n  linear: (t: number) => t,\r\n\r\n  /** accelerating from zero velocity */\r\n  easeInQuad: (t: number) => t * t,\r\n\r\n  /** decelerating to zero velocity */\r\n  easeOutQuad: (t: number) => t * (2 - t),\r\n\r\n  /** acceleration until halfway, then deceleration */\r\n  easeInOutQuad: (t: number) => (t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t),\r\n\r\n  /** accelerating from zero velocity */\r\n  easeInCubic: (t: number) => t * t * t,\r\n\r\n  /** decelerating to zero velocity */\r\n  easeOutCubic: (t: number) => --t * t * t + 1,\r\n\r\n  /** acceleration until halfway, then deceleration */\r\n  easeInOutCubic: (t: number) =>\r\n    t < 0.5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1,\r\n  /** accelerating from zero velocity */\r\n  easeInQuart: (t: number) => t * t * t * t,\r\n\r\n  /** decelerating to zero velocity */\r\n  easeOutQuart: (t: number) => 1 - --t * t * t * t,\r\n\r\n  /** acceleration until halfway, then deceleration */\r\n  easeInOutQuart: (t: number) =>\r\n    t < 0.5 ? 8 * t * t * t * t : 1 - 8 * --t * t * t * t,\r\n  /** accelerating from zero velocity */\r\n  easeInQuint: (t: number) => t * t * t * t * t,\r\n\r\n  /** decelerating to zero velocity */\r\n  easeOutQuint: (t: number) => 1 + --t * t * t * t * t,\r\n\r\n  /** acceleration until halfway, then deceleration */\r\n  easeInOutQuint: (t: number) =>\r\n    t < 0.5 ? 16 * t * t * t * t * t : 1 + 16 * --t * t * t * t * t\r\n};\r\n\r\nexport function normalize(x: number, min: number, max: number) {\r\n  return (x - min) / (max - min);\r\n}\r\n\r\nexport function denormalize(x: number, min: number, max: number) {\r\n  return min + (max - min) * x;\r\n}\r\n\r\nexport const interpolate = (\r\n  f: (x: number) => number,\r\n  range: { from: number; to: number }\r\n) => (x: number) => {\r\n  const result = f(normalize(x, range.from, range.to));\r\n  return denormalize(result, range.from, range.to);\r\n};\r\n\r\nexport default easing;\r\n","import { BaseAnimation, Point2D } from \"./animation\";\r\nimport easing from \"./easing\";\r\n\r\nexport type ColorSample = {\r\n  palette: string[];\r\n  prominentColor: string;\r\n};\r\n\r\ntype PaletteAnimationConfig = {\r\n  ctx: CanvasRenderingContext2D;\r\n  swatch: ColorSample;\r\n  topLeft: Point2D;\r\n  boxSize: number;\r\n  duration: number;\r\n};\r\n\r\nexport class PaletteAnimation extends BaseAnimation {\r\n  swatch: ColorSample;\r\n  topLeft: Point2D;\r\n  current: Point2D;\r\n  boxSize: number;\r\n  duration: number;\r\n  temporary: boolean;\r\n  currentColorIndex: number;\r\n\r\n  constructor({\r\n    ctx,\r\n    swatch,\r\n    topLeft,\r\n    boxSize,\r\n    duration,\r\n  }: PaletteAnimationConfig) {\r\n    super(ctx);\r\n\r\n    this.swatch = swatch;\r\n    this.topLeft = { ...topLeft };\r\n    this.current = { ...topLeft };\r\n    this.boxSize = boxSize;\r\n    this.duration = duration;\r\n    this.temporary = false;\r\n    this.currentColorIndex = Math.floor(\r\n      Math.abs(this.current.x - this.topLeft.x) / this.boxSize\r\n    );\r\n  }\r\n\r\n  setTemporary = (value: boolean) => (this.temporary = value);\r\n\r\n  updateAnimation = (deltaTime: number) => {\r\n    if (!deltaTime || deltaTime === 0) return false;\r\n    if (this.isFinished()) return true;\r\n\r\n    this.currentColorIndex = Math.floor(\r\n      Math.abs(this.current.x - this.topLeft.x) / this.boxSize\r\n    );\r\n    const part = deltaTime / this.duration;\r\n    this.current.x += this.swatch.palette.length * this.boxSize * part;\r\n    if (this.currentColorIndex >= this.swatch.palette.length) {\r\n      this.currentColorIndex = this.swatch.palette.length - 1;\r\n      this.setFinished(true);\r\n    }\r\n\r\n    return this.isFinished();\r\n  };\r\n\r\n  draw = () => {\r\n    for (let i = 0; i < this.currentColorIndex + 1; i++) {\r\n      this.ctx.fillStyle = this.swatch.palette[i];\r\n      this.fillRect(\r\n        this.topLeft.x + this.boxSize * i,\r\n        this.topLeft.y,\r\n        this.boxSize,\r\n        this.boxSize\r\n      );\r\n    }\r\n  };\r\n}\r\n\r\ntype HighlightPaletteAnimationConfig = {\r\n  animation: PaletteAnimation;\r\n  duration: number;\r\n  easingFunction?: (x: number) => number;\r\n};\r\n\r\nenum HighlightPatternState {\r\n  Cycling,\r\n  Blinking,\r\n  Focus,\r\n}\r\n\r\nexport class HighlightPaletteAnimation extends BaseAnimation {\r\n  readonly animation: PaletteAnimation;\r\n  private LoopCount = 2;\r\n\r\n  xOffset = 0;\r\n\r\n  private state: { state: HighlightPatternState; elapsedTime: number } = {\r\n    state: HighlightPatternState.Cycling,\r\n    elapsedTime: 0,\r\n  };\r\n\r\n  private readonly finalIndex: number;\r\n\r\n  elapsedTime = 0;\r\n  private currentIndex = 0;\r\n  private boxOpacity = 1;\r\n  private increasingOpacity = false;\r\n\r\n  temporary = false;\r\n\r\n  private cycleDurationMs: number;\r\n  private totalDurationMs: number;\r\n\r\n  private readonly FadeOutInDurationMs = 250;\r\n  private readonly BlinkAmount = 3;\r\n\r\n  private readonly BlinkDurationMs =\r\n    this.FadeOutInDurationMs * this.BlinkAmount;\r\n  private readonly FocusDurationMs = 1000;\r\n\r\n  easingFunction: (x: number) => number;\r\n\r\n  constructor({\r\n    animation,\r\n    duration,\r\n    easingFunction,\r\n  }: HighlightPaletteAnimationConfig) {\r\n    super(animation.ctx);\r\n\r\n    this.cycleDurationMs =\r\n      duration - this.BlinkDurationMs - this.FadeOutInDurationMs;\r\n\r\n    this.totalDurationMs =\r\n      this.cycleDurationMs + this.BlinkDurationMs + this.FocusDurationMs;\r\n\r\n    this.animation = animation;\r\n\r\n    const prominentIndex = animation.swatch.palette.findIndex(\r\n      color => color === animation.swatch.prominentColor\r\n    );\r\n    this.finalIndex =\r\n      this.LoopCount * animation.swatch.palette.length + prominentIndex;\r\n\r\n    this.easingFunction = easingFunction ?? ((t: number) => t);\r\n  }\r\n\r\n  updateAnimation = (deltaTime: number) => {\r\n    if (!deltaTime || deltaTime === 0) return false;\r\n\r\n    this.animation.update(deltaTime);\r\n    if (!this.animation.isFinished()) return false;\r\n    if (this.isFinished()) return true;\r\n\r\n    this.elapsedTime = Math.min(\r\n      this.elapsedTime + deltaTime,\r\n      this.totalDurationMs\r\n    );\r\n\r\n    this.state.elapsedTime += deltaTime;\r\n\r\n    const t = Math.min(this.elapsedTime / this.cycleDurationMs, 1);\r\n    this.currentIndex = Math.round(this.easingFunction(t) * this.finalIndex);\r\n    const highlightIndex =\r\n      this.currentIndex % this.animation.swatch.palette.length;\r\n\r\n    this.xOffset = highlightIndex * this.animation.boxSize;\r\n\r\n    switch (this.state.state) {\r\n      case HighlightPatternState.Cycling:\r\n        if (this.state.elapsedTime >= this.cycleDurationMs)\r\n          this.state = {\r\n            state: HighlightPatternState.Blinking,\r\n            elapsedTime: 0,\r\n          };\r\n        break;\r\n\r\n      case HighlightPatternState.Blinking: {\r\n        this.updateOpacity(deltaTime);\r\n        if (this.state.elapsedTime >= this.BlinkDurationMs) {\r\n          this.state = {\r\n            state: HighlightPatternState.Focus,\r\n            elapsedTime: 0,\r\n          };\r\n          this.animation.fadeOut(1000, easing.easeOutCubic);\r\n        }\r\n        break;\r\n      }\r\n      case HighlightPatternState.Focus:\r\n        if (this.state.elapsedTime >= this.FocusDurationMs) {\r\n          this.setFinished(true);\r\n        }\r\n    }\r\n\r\n    return this.isFinished();\r\n  };\r\n\r\n  draw = () => {\r\n    this.animation.render();\r\n    if (!this.animation.isFinished()) return;\r\n\r\n    if (this.state.state === HighlightPatternState.Focus) {\r\n      const oldFillStyle = this.ctx.fillStyle;\r\n      this.ctx.fillStyle = this.animation.swatch.prominentColor;\r\n      this.fillRect(\r\n        this.animation.topLeft.x + this.xOffset,\r\n        this.animation.topLeft.y,\r\n        this.animation.boxSize,\r\n        this.animation.boxSize\r\n      );\r\n      this.ctx.fillStyle = oldFillStyle;\r\n    }\r\n\r\n    const oldOpacity = this.ctx.globalAlpha;\r\n    const oldWidth = this.ctx.lineWidth;\r\n\r\n    if (this.state.state === HighlightPatternState.Blinking) {\r\n      this.ctx.globalAlpha = this.boxOpacity;\r\n    }\r\n\r\n    this.ctx.save();\r\n    this.ctx.lineWidth = 5;\r\n    this.strokeRect(\r\n      this.animation.topLeft.x + this.xOffset,\r\n      this.animation.topLeft.y,\r\n      this.animation.boxSize,\r\n      this.animation.boxSize\r\n    );\r\n    this.ctx.restore();\r\n\r\n    this.ctx.globalAlpha = oldOpacity;\r\n    this.ctx.lineWidth = oldWidth;\r\n  };\r\n\r\n  highlightPosition = (): Point2D => {\r\n    const pos = { ...this.animation.topLeft };\r\n    pos.x += this.xOffset;\r\n    return pos;\r\n  };\r\n\r\n  updateOpacity = (deltaTime: number) => {\r\n    const deltaOpacity = deltaTime / 6 / 50;\r\n    if (this.increasingOpacity) {\r\n      this.boxOpacity += deltaOpacity;\r\n\r\n      if (this.boxOpacity > 1) {\r\n        this.boxOpacity = 1;\r\n        this.increasingOpacity = false;\r\n      }\r\n    } else {\r\n      this.boxOpacity -= deltaOpacity;\r\n\r\n      if (this.boxOpacity < 0) {\r\n        this.boxOpacity = 0;\r\n        this.increasingOpacity = true;\r\n      }\r\n    }\r\n  };\r\n}\r\n\r\nexport const highlightPalette = (config: HighlightPaletteAnimationConfig) =>\r\n  new HighlightPaletteAnimation(config);\r\n","import { BaseAnimation, Point2D, BaseSequential, Animation } from \"./animation\";\r\nimport { EasingFunction, denormalize } from \"./easing\";\r\n\r\ntype RectangleThunk = (rectangle: Rectangle) => RectangleAnimation;\r\n\r\ntype Size = {\r\n  width: number;\r\n  height: number;\r\n};\r\n\r\ninterface RectangleAnimationArgs {\r\n  ctx: CanvasRenderingContext2D;\r\n  rectangle: Rectangle;\r\n  duration: number;\r\n  easingFunction?: EasingFunction;\r\n}\r\n\r\nabstract class RectangleAnimation extends BaseAnimation {\r\n  rectangle: Rectangle;\r\n  duration: number;\r\n  protected elapsedTime = 0;\r\n  protected easingFunction: EasingFunction = (t: number) => t;\r\n\r\n  constructor({\r\n    ctx,\r\n    rectangle,\r\n    duration,\r\n    easingFunction,\r\n  }: RectangleAnimationArgs) {\r\n    super(ctx);\r\n\r\n    this.rectangle = rectangle;\r\n    this.duration = duration;\r\n\r\n    if (easingFunction) this.easingFunction = easingFunction;\r\n  }\r\n\r\n  draw = () => {\r\n    this.ctx.save();\r\n    this.ctx.fillStyle = this.rectangle.color;\r\n    this.fillRect(\r\n      this.rectangle.x,\r\n      this.rectangle.y,\r\n      this.rectangle.width,\r\n      this.rectangle.height\r\n    );\r\n    this.ctx.restore();\r\n  };\r\n}\r\n\r\nexport class Rectangle {\r\n  x: number;\r\n  y: number;\r\n  width: number;\r\n  height: number;\r\n  color: string;\r\n\r\n  constructor(color: string, x = 0, y = 0, width = 0, height = 0) {\r\n    this.color = color;\r\n    this.x = x;\r\n    this.y = y;\r\n    this.width = width;\r\n    this.height = height;\r\n  }\r\n\r\n  static animate(ctx: CanvasRenderingContext2D): RectangleAnimations {\r\n    return new RectangleAnimations(ctx);\r\n  }\r\n\r\n  static scale({\r\n    ctx,\r\n    duration,\r\n    size,\r\n    easingFunction,\r\n    name,\r\n  }: {\r\n    ctx: CanvasRenderingContext2D;\r\n    duration: number;\r\n    size: Size;\r\n    easingFunction?: EasingFunction;\r\n    name?: string;\r\n  }): RectangleAnimations {\r\n    const thunk: RectangleThunk = rectangle => {\r\n      // eslint-disable-next-line @typescript-eslint/no-use-before-define\r\n      const animation = new Scale({\r\n        ctx,\r\n        rectangle,\r\n        duration,\r\n        toSize: size,\r\n        easingFunction,\r\n      });\r\n      if (name) {\r\n        animation.setName(name);\r\n      }\r\n\r\n      return animation;\r\n    };\r\n\r\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\r\n    return new RectangleAnimations(ctx, thunk);\r\n  }\r\n\r\n  static translate(\r\n    ctx: CanvasRenderingContext2D,\r\n    duration: number,\r\n    to: Point2D\r\n  ): RectangleAnimations {\r\n    const thunk: RectangleThunk = rectangle => {\r\n      // eslint-disable-next-line @typescript-eslint/no-use-before-define\r\n      return new Translate({\r\n        ctx,\r\n        rectangle,\r\n        duration,\r\n        to,\r\n      });\r\n    };\r\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\r\n    return new RectangleAnimations(ctx, thunk);\r\n  }\r\n\r\n  scale = (\r\n    ctx: CanvasRenderingContext2D,\r\n    duration: number,\r\n    size: Size\r\n  ): RectangleAnimations => {\r\n    const thunk: RectangleThunk = rectangle => {\r\n      // eslint-disable-next-line @typescript-eslint/no-use-before-define\r\n      return new Scale({\r\n        ctx,\r\n        rectangle,\r\n        duration,\r\n        toSize: size,\r\n      });\r\n    };\r\n\r\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\r\n    return new RectangleAnimations(ctx, thunk, this);\r\n  };\r\n\r\n  translate = (\r\n    ctx: CanvasRenderingContext2D,\r\n    duration: number,\r\n    to: Point2D\r\n  ): RectangleAnimations => {\r\n    const thunk: RectangleThunk = rectangle => {\r\n      // eslint-disable-next-line @typescript-eslint/no-use-before-define\r\n      return new Translate({\r\n        ctx,\r\n        rectangle,\r\n        duration,\r\n        to,\r\n      });\r\n    };\r\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\r\n    return new RectangleAnimations(ctx, thunk, this);\r\n  };\r\n}\r\n\r\ninterface ScaleArgs extends RectangleAnimationArgs {\r\n  toSize: Size;\r\n}\r\nexport class Scale extends RectangleAnimation {\r\n  toSize: Size;\r\n  fromSize: Size;\r\n\r\n  constructor({ ctx, toSize, duration, rectangle, easingFunction }: ScaleArgs) {\r\n    super({ ctx, rectangle, duration, easingFunction });\r\n\r\n    this.duration = duration;\r\n    this.toSize = toSize;\r\n    this.rectangle = rectangle;\r\n\r\n    this.fromSize = {\r\n      width: this.rectangle.width,\r\n      height: this.rectangle.height,\r\n    };\r\n  }\r\n\r\n  updateAnimation = (deltaTime: number): boolean => {\r\n    if (this.isFinished()) return true;\r\n\r\n    this.elapsedTime = Math.min(this.elapsedTime + deltaTime, this.duration);\r\n\r\n    const t = this.easingFunction(this.elapsedTime / this.duration);\r\n    const width = denormalize(t, this.fromSize.width, this.toSize.width);\r\n    const height = denormalize(t, this.fromSize.height, this.toSize.height);\r\n\r\n    const deltaWidth = width - this.rectangle.width;\r\n    this.rectangle.x -= deltaWidth / 2;\r\n\r\n    const deltaHeight = height - this.rectangle.height;\r\n    this.rectangle.y -= deltaHeight / 2;\r\n\r\n    this.rectangle.width = width;\r\n    this.rectangle.height = height;\r\n\r\n    if (this.elapsedTime >= this.duration) {\r\n      this.setFinished(true);\r\n    }\r\n\r\n    return this.isFinished();\r\n  };\r\n}\r\n\r\ninterface TranslateArgs extends RectangleAnimationArgs {\r\n  to: Point2D;\r\n}\r\nexport class Translate extends RectangleAnimation {\r\n  from: Point2D;\r\n  to: Point2D;\r\n\r\n  constructor({ ctx, duration, to, rectangle, easingFunction }: TranslateArgs) {\r\n    super({ ctx, rectangle, duration, easingFunction });\r\n\r\n    this.duration = duration;\r\n    this.from = {\r\n      x: this.rectangle.x,\r\n      y: this.rectangle.y,\r\n    };\r\n    this.to = to;\r\n  }\r\n\r\n  updateAnimation = (deltaTime: number): boolean => {\r\n    if (this.isFinished()) return true;\r\n\r\n    this.elapsedTime = Math.min(this.elapsedTime + deltaTime, this.duration);\r\n\r\n    const t = this.easingFunction(this.elapsedTime / this.duration);\r\n    const x = denormalize(t, this.from.x, this.to.x);\r\n    const y = denormalize(t, this.from.y, this.to.y);\r\n\r\n    this.rectangle.x = x;\r\n    this.rectangle.y = y;\r\n\r\n    if (this.elapsedTime >= this.duration) {\r\n      this.setFinished(true);\r\n    }\r\n\r\n    return this.isFinished();\r\n  };\r\n}\r\n\r\nclass RectangleAnimations extends BaseSequential {\r\n  private animations: Animation[] = [];\r\n  private animationThunks: RectangleThunk[] = [];\r\n\r\n  private rectangle?: Rectangle;\r\n  constructor(\r\n    ctx: CanvasRenderingContext2D,\r\n    thunk?: RectangleThunk,\r\n    rectangle?: Rectangle\r\n  ) {\r\n    super(ctx);\r\n\r\n    if (rectangle) this.rectangle = rectangle;\r\n    if (thunk) this.addThunk(thunk);\r\n  }\r\n\r\n  size = (): number => this.animations.length + this.animationThunks.length;\r\n\r\n  removeAtIndex = (index: number): void => {\r\n    this.animations.splice(index, 1);\r\n  };\r\n\r\n  get = (index: number): Animation => {\r\n    while (index >= this.animations.length) {\r\n      this.materializeThunk();\r\n    }\r\n    return this.animations[index];\r\n  };\r\n\r\n  add = (animation: Animation): void => {\r\n    this.animations.push(animation);\r\n  };\r\n\r\n  private materializeThunk = () => {\r\n    this.add(this.animationThunks[0](this.rectangle as Rectangle));\r\n    this.animationThunks.splice(0, 1);\r\n  };\r\n\r\n  setRectangle = (rectangle: Rectangle) => {\r\n    const rect = { ...rectangle };\r\n    this.rectangle = rect;\r\n  };\r\n\r\n  private addThunk = (thunk: RectangleThunk) => {\r\n    this.animationThunks.push(thunk);\r\n  };\r\n\r\n  scale = ({\r\n    duration,\r\n    size,\r\n    easingFunction,\r\n  }: {\r\n    duration: number;\r\n    size: Size;\r\n    easingFunction?: EasingFunction;\r\n  }): RectangleAnimations => {\r\n    this.addThunk(\r\n      rectangle =>\r\n        new Scale({\r\n          ctx: this.ctx,\r\n          rectangle,\r\n          duration,\r\n          toSize: size,\r\n          easingFunction,\r\n        })\r\n    );\r\n\r\n    return this;\r\n  };\r\n\r\n  translate = ({\r\n    duration,\r\n    to,\r\n    easingFunction,\r\n    name,\r\n  }: {\r\n    duration: number;\r\n    to: Point2D;\r\n    easingFunction?: EasingFunction;\r\n    name?: string;\r\n  }): RectangleAnimations => {\r\n    this.addThunk(rectangle => {\r\n      const animation = new Translate({\r\n        ctx: this.ctx,\r\n        rectangle,\r\n        duration,\r\n        to,\r\n        easingFunction,\r\n      });\r\n      if (name) animation.setName(name);\r\n      return animation;\r\n    });\r\n\r\n    return this;\r\n  };\r\n}\r\n","import { BaseAnimation, Point2D } from \"./animation\";\r\n\r\nexport class LineAnimation extends BaseAnimation {\r\n  from: Point2D;\r\n  to: Point2D;\r\n  current: Point2D;\r\n  duration: number;\r\n  abs: Point2D;\r\n\r\n  constructor(\r\n    ctx: CanvasRenderingContext2D,\r\n    from: Point2D,\r\n    to: Point2D,\r\n    duration: number\r\n  ) {\r\n    super(ctx);\r\n\r\n    this.from = { ...from };\r\n    this.to = { ...to };\r\n    this.current = { ...from };\r\n    this.duration = duration;\r\n    this.abs = { x: Math.abs(to.x - from.x), y: Math.abs(to.y - from.y) };\r\n  }\r\n\r\n  setTemporary = (value: boolean) => {\r\n    this.temporary = value;\r\n  };\r\n\r\n  updateAnimation = (delta: number) => {\r\n    if (!delta || delta === 0) return false;\r\n    if (this.isFinished()) return true;\r\n\r\n    const part = delta / this.duration;\r\n    this.current.x += (this.to.x - this.from.x) * part;\r\n    this.current.y += (this.to.y - this.from.y) * part;\r\n    if (\r\n      this.abs.x <= Math.abs(this.current.x - this.from.x) &&\r\n      this.abs.y <= Math.abs(this.current.y - this.from.y)\r\n    ) {\r\n      this.current = this.to;\r\n      // console.log(\"LineAnimation finished\");\r\n      this.setFinished(true);\r\n    }\r\n\r\n    return this.isFinished();\r\n  };\r\n\r\n  draw = () => {\r\n    this.ctx.beginPath();\r\n    this.ctx.moveTo(this.from.x, this.from.y);\r\n    this.ctx.lineTo(this.current.x, this.current.y);\r\n    this.stroke();\r\n  };\r\n}\r\n","export interface Entity {\r\n  update: (deltaTime: number) => unknown;\r\n  draw: () => void;\r\n  shouldDelete: () => boolean;\r\n}\r\n\r\nexport default class CanvasLoop {\r\n  canvas: HTMLCanvasElement;\r\n  ctx: CanvasRenderingContext2D;\r\n  onFinish?: () => void;\r\n\r\n  private entities: Entity[] = [];\r\n  private finished = false;\r\n  private lastUpdateTime?: number;\r\n\r\n  static create = (canvas: HTMLCanvasElement): CanvasLoop | null => {\r\n    if (canvas.getContext(\"2d\") === null) return null;\r\n    return new CanvasLoop(canvas);\r\n  };\r\n\r\n  private constructor(canvas: HTMLCanvasElement) {\r\n    this.canvas = canvas;\r\n    this.ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\r\n  }\r\n\r\n  clear = (): void => {\r\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n  };\r\n\r\n  addEntity = (entity: Entity): void => {\r\n    this.entities.push(entity);\r\n    if (this.finished) {\r\n      this.finished = false;\r\n      this.start();\r\n    }\r\n  };\r\n\r\n  start = (): void => {\r\n    this.requestFrame();\r\n  };\r\n\r\n  private requestFrame = (): void => {\r\n    window.requestAnimationFrame(this.update);\r\n  };\r\n\r\n  private finish = (): void => {\r\n    if (!this.finished) {\r\n      this.finished = true;\r\n      this.onFinish?.();\r\n    }\r\n  };\r\n\r\n  private update = (): void => {\r\n    if (this.entities.length === 0) {\r\n      this.finish();\r\n    }\r\n    if (this.finished) return;\r\n\r\n    this.clear();\r\n\r\n    if (this.lastUpdateTime === undefined) {\r\n      this.lastUpdateTime = Date.now();\r\n      this.requestFrame();\r\n    }\r\n\r\n    const now = Date.now();\r\n    const dt = now - this.lastUpdateTime;\r\n    this.lastUpdateTime = now;\r\n\r\n    for (let i = 0; i < this.entities.length; ++i) {\r\n      if (this.entities[i].shouldDelete()) {\r\n        this.entities.splice(i, 1);\r\n        continue;\r\n      }\r\n\r\n      this.entities[i].update(dt);\r\n    }\r\n\r\n    this.entities.forEach(e => e.draw());\r\n\r\n    this.requestFrame();\r\n  };\r\n}\r\n"],"sourceRoot":""}